import{default as router}from"./routes.js";import{default as i18n}from"./i18n.js";import{default as spieldoseAPI}from"./api.js";import{bus}from"./bus.js";import{mixinAPIError,mixinPlayer}from"./mixins.js";const getApiErrorDataFromResponse=function(e){var r={request:{method:e.rMethod,url:e.rUrl,body:e.rBody},response:{status:e.status,statusText:e.statusText,text:e.bodyText}};for(var s in r.request.headers=[],e.rHeaders.map)r.request.headers.push({name:s,value:e.rHeaders.get(s)});for(var s in r.response.headers=[],e.headers.map)r.response.headers.push({name:s,value:e.headers.get(s)});return r};Vue.http.interceptors.push(((e,r)=>{r((r=>(r.ok||(r.rBody=e.body,r.rUrl=e.url,r.rMethod=e.method,r.rHeaders=e.headers,r.getApiErrorData=function(){return getApiErrorDataFromResponse(r)},400!=r.status&&409!=r.status||(r.isFieldInvalid=function(e){return r.body.invalidOrMissingParams.indexOf(e)>-1})),r)))}));const app=new Vue({router,i18n,mixins:[mixinAPIError,mixinPlayer],data:function(){return{logged:!1,errors:!1,apiError:null}},created:function(){bus.$on("signOut",(()=>{this.signOut()})),initialState.upgradeAvailable?this.$router.push({name:"upgrade"}):initialState.logged?this.$route.name||this.$router.push({name:"dashboard"}):"signin"!=this.$route.name&&this.$router.push({name:"signin"})},methods:{signOut:function(){this.playerData.dispose(),this.clearAPIErrors(),spieldoseAPI.session.signOut((e=>{e.ok?this.$router.push({path:"/signin"}):this.setAPIError(e.getApiErrorData())}))},poll:function(e){spieldoseAPI.session.poll((r=>{e&&"function"==typeof e&&e(r)}))}}}).$mount("#app");setInterval((function(){spieldoseAPI.session.poll((function(){}))}),3e5);
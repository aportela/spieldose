import{default as spieldoseAPI}from"../api.js";import{mixinAPIError,mixinPlayer,mixinPagination,mixinLiveSearches,mixinArtists,mixinAlbums}from"../mixins.js";const template=function(){return'\n        <div class="container is-fluid box is-marginless">\n            <p v-if="loading" class="title is-1 has-text-centered">Loading <i v-if="loading" class="fas fa-cog fa-spin fa-fw"></i></p>\n            <p v-else="! loading" class="title is-1 has-text-centered">{{ $t("browseArtist.labels.sectionName") }}</p>\n            <div class="media" v-if="! hasAPIErrors && ! loading">\n                <figure class="image media-left">\n                    <img class="artist_avatar" v-bind:src="artist.image | getArtistImageUrl" v-on:error="artist.image = null;">\n                </figure>\n                <div class="media-content is-light">\n                    <p class="title is-1">{{ artist.name }}</p>\n                    <p class="subtitle is-6" v-if="artist.playCount > 0">{{ artist.playCount }} {{ $t("browseArtist.labels.plays") }}</p>\n                    <p class="subtitle is-6" v-else>{{ $t("browseArtist.labels.notPlayedYet") }}</p>\n                    <div class="tabs is-medium">\n                        <ul>\n                            <li v-bind:class="{ \'is-active\' : activeTab == \'overview\' }"><a v-on:click.prevent="$router.push({ name: \'artist\', params: { \'artist\': $route.params.artist } })">{{ $t("browseArtist.tabs.overview") }}</a></li>\n                            <li v-bind:class="{ \'is-active\' : activeTab == \'bio\' }"><a v-on:click.prevent="$router.push({ name: \'artistBio\' })">{{ $t("browseArtist.tabs.bio") }}</a></li>\n                            <li v-bind:class="{ \'is-active\' : activeTab == \'tracks\' }"><a v-on:click.prevent="$router.push({ name: \'artistTracks\' })">{{ $t("browseArtist.tabs.tracks") }}</a></li>\n                            <li v-bind:class="{ \'is-active\' : activeTab == \'albums\' }"><a v-on:click.prevent="$router.push({ name: \'artistAlbums\' })">{{ $t("browseArtist.tabs.albums") }}</a></li>\n                            <li v-bind:class="{ \'is-active\' : activeTab == \'update\' }"><a v-on:click.prevent="$router.push({ name: \'artistUpdate\' })">{{ $t("browseArtist.tabs.updateArtist") }}</a></li>\n                        </ul>\n                    </div>\n                    <div class="panel" v-if="activeTab == \'overview\'">\n                        <div class="content is-clearfix" id="bio" v-if="artist.bio" v-html="truncatedBio"></div>\n                        <div class="content is-clearfix" id="bio" v-else>Artist biography not found / not scraped</div>\n                        <div class="columns">\n                            <div class="column is-half is-full-mobile">\n                                <spieldose-dashboard-toplist v-if="activeTab == \'overview\' && artist.name" v-bind:type="\'topTracks\'" v-bind:title="$t(\'dashboard.labels.topPlayedTracks\')" v-bind:listItemCount="10" v-bind:showPlayCount="true" :key="$route.params.artist" v-bind:artist="$route.params.artist"></spieldose-dashboard-toplist>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="panel" v-if="activeTab == \'bio\'">\n                        <div class="content is-clearfix" id="bio" v-html="artist.bio"></div>\n                    </div>\n                    <div class="panel" v-if="activeTab == \'tracks\'">\n                        <div class="field has-addons">\n                            <div class="control is-expanded has-icons-left" v-bind:class="loadingTracks ? \'is-loading\': \'\'">\n                                <input class="input" :disabled="loadingTracks" v-if="liveSearch" v-model.trim="nameFilter" type="text" placeholder="search by text..." v-on:keyup.esc="abortInstantSearch();" v-on:keyup="instantSearch();">\n                                <input class="input" :disabled="loadingTracks" v-else v-model.trim="nameFilter" type="text" placeholder="search by text..." v-on:keyup.enter="searchTracks();">\n                                <span class="icon is-small is-left">\n                                    <i class="fas fa-search"></i>\n                                </span>\n                            </div>\n                            <p class="control" v-if="! liveSearch">\n                                <a class="button is-info" v-on:click.prevent="searchTracks();">\n                                    <span class="icon">\n                                        <i class="fas fa-search" aria-hidden="true"></i>\n                                    </span>\n                                    <span>{{ $t("browseArtist.buttons.search") }}</span>\n                                </a>\n                            </p>\n                        </div>\n                        <spieldose-pagination v-bind:loading="loadingTracks" v-bind:data="pager" v-on:pagination-changed="onPaginationChanged"></spieldose-pagination>\n                        <table class="table is-bordered is-striped is-narrow is-fullwidth">\n                            <thead>\n                                    <tr class="is-unselectable">\n                                        <th>{{ $t("browseArtist.labels.tracksAlbumTableHeader") }}</th>\n                                        <th>{{ $t("browseArtist.labels.tracksSectionYearTableHeader") }}</th>\n                                        <th>{{ $t("browseArtist.labels.tracksSectionNumberTableHeader") }}</th>\n                                        <th>{{ $t("browseArtist.labels.tracksSectionTitleTableHeader") }}</th>\n                                        <th>{{ $t("browseArtist.labels.tracksSectionActionTableHeader") }}</th>\n                                    </tr>\n                            </thead>\n                            <tbody>\n                                <tr v-for="track, i in tracks">\n                                    <td><span>{{ track.album }}</span></td>\n                                    <td><span>{{ track.year }}</span></td>\n                                    <td>{{ track.number }}</td>\n                                    <td>\n                                        <span> {{ track.title}}</span>\n                                    </td>\n                                    <td>\n                                        <i class="cursor-pointer fa fa-play" v-bind:title="$t(\'commonLabels.playThisTrack\')" v-on:click.prevent="playerData.currentPlaylist.replace([track]);"></i>\n                                        <i class="cursor-pointer fa fa-plus-square"  v-bind:title="$t(\'commonLabels.enqueueThisTrack\')" v-on:click.prevent="playerData.currentPlaylist.enqueue([track]);"></i>\n                                        <i class="cursor-pointer fa fa-save"  v-bind:title="$t(\'commonLabels.downloadThisTrack\')" v-on:click.prevent="playerData.download(track.id);"></i>\n                                    </td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                    <div class="panel" v-if="activeTab == \'albums\'">\n                        <div class="browse-album-item" v-show="! loading" v-for="album, i in artist.albums" v-bind:key="i">\n                        <a class="play-album" v-bind:title="$t(\'commonLabels.playThisAlbum\')" v-on:click.prevent="playAlbumTracks(album.name, album.artist, album.year);">\n                                <img class="album-thumbnail" v-bind:src="album.image | getAlbumImageUrl" v-on:error="album.image = null;">\n                                <i class="fas fa-play fa-4x"></i>\n                                <img class="vinyl no-cover" src="images/vinyl.png" />\n                            </a>\n                            <div class="album-info">\n                                <p class="album-name">{{ album.name }}</p>\n                                <p class="album-year" v-show="album.year">({{ album.year }})</p>\n                            </div>\n                        </div>\n                        <div class="is-clearfix"></div>\n                    </div>\n                    <div class="panel" v-if="activeTab == \'update\'">\n                        <div class="panel-block">\n                            <div class="content is-clearfix">\n                                <div class="field is-horizontal has-addons">\n                                    <div class="field-label is-normal">\n                                        <label class="label">{{ $t("browseArtist.labels.musicBrainzSearchArtistName") }}</label>\n                                    </div>\n                                    <div class="field-body">\n                                        <div class="field is-expanded has-addons">\n                                            <div class="control has-icons-left is-expanded" v-bind:class="loading ? \'is-loading\': \'\'">\n                                                <input class="input" :disabled="loading" v-model.trim="artist.name" type="text" v-bind:placeholder="$t(\'browseArtist.labels.musicBrainzSearchArtistNamePlaceholder\')">\n                                                <span class="icon is-small is-left">\n                                                    <i class="fas fa-search"></i>\n                                                </span>\n                                            </div>\n                                            <div class="control">\n                                                <a class="button is-info" v-on:click.prevent="searchMusicBrainz();">{{ $t("browseArtist.buttons.searchOnMusicBrainz") }}</a>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class="field is-horizontal has-addons">\n                                    <div class="field-label is-normal">\n                                        <label class="label">{{ $t("browseArtist.labels.musicBrainzSearchArtistMBId") }}</label>\n                                    </div>\n                                    <div class="field-body">\n                                        <div class="field is-expanded has-addons">\n                                            <div class="control has-icons-left is-expanded" v-bind:class="loading ? \'is-loading\': \'\'">\n                                                <input class="input" :disabled="loading" v-model.trim="artist.mbid" type="text" v-bind:placeholder="$t(\'browseArtist.labels.musicBrainzSearchArtistMBIdPlaceholder\')">\n                                                <span class="icon is-small is-left">\n                                                    <i class="fas fa-search"></i>\n                                                </span>\n                                            </div>\n                                            <div class="control">\n                                                <a class="button is-info" :disabled="! (artist.name && artist.mbid)" v-on:click.prevent="overwriteMusicBrainzArtist(artist.name, artist.mbid);">{{ $t("browseArtist.buttons.save") }}</a>\n                                            </div>\n                                            <div class="control">\n                                                <a class="button is-danger" v-on:click.prevent="clearMusicBrainzArtist(artist.name, artist.mbid);">{{ $t("browseArtist.buttons.clear") }}</a>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <spieldose-api-error-component v-if="hasAPIErrors" v-bind:apiError="apiError"></spieldose-api-error-component>\n        </div>\n    '};export default{name:"spieldose-browse-artist",template:'\n        <div class="container is-fluid box is-marginless">\n            <p v-if="loading" class="title is-1 has-text-centered">Loading <i v-if="loading" class="fas fa-cog fa-spin fa-fw"></i></p>\n            <p v-else="! loading" class="title is-1 has-text-centered">{{ $t("browseArtist.labels.sectionName") }}</p>\n            <div class="media" v-if="! hasAPIErrors && ! loading">\n                <figure class="image media-left">\n                    <img class="artist_avatar" v-bind:src="artist.image | getArtistImageUrl" v-on:error="artist.image = null;">\n                </figure>\n                <div class="media-content is-light">\n                    <p class="title is-1">{{ artist.name }}</p>\n                    <p class="subtitle is-6" v-if="artist.playCount > 0">{{ artist.playCount }} {{ $t("browseArtist.labels.plays") }}</p>\n                    <p class="subtitle is-6" v-else>{{ $t("browseArtist.labels.notPlayedYet") }}</p>\n                    <div class="tabs is-medium">\n                        <ul>\n                            <li v-bind:class="{ \'is-active\' : activeTab == \'overview\' }"><a v-on:click.prevent="$router.push({ name: \'artist\', params: { \'artist\': $route.params.artist } })">{{ $t("browseArtist.tabs.overview") }}</a></li>\n                            <li v-bind:class="{ \'is-active\' : activeTab == \'bio\' }"><a v-on:click.prevent="$router.push({ name: \'artistBio\' })">{{ $t("browseArtist.tabs.bio") }}</a></li>\n                            <li v-bind:class="{ \'is-active\' : activeTab == \'tracks\' }"><a v-on:click.prevent="$router.push({ name: \'artistTracks\' })">{{ $t("browseArtist.tabs.tracks") }}</a></li>\n                            <li v-bind:class="{ \'is-active\' : activeTab == \'albums\' }"><a v-on:click.prevent="$router.push({ name: \'artistAlbums\' })">{{ $t("browseArtist.tabs.albums") }}</a></li>\n                            <li v-bind:class="{ \'is-active\' : activeTab == \'update\' }"><a v-on:click.prevent="$router.push({ name: \'artistUpdate\' })">{{ $t("browseArtist.tabs.updateArtist") }}</a></li>\n                        </ul>\n                    </div>\n                    <div class="panel" v-if="activeTab == \'overview\'">\n                        <div class="content is-clearfix" id="bio" v-if="artist.bio" v-html="truncatedBio"></div>\n                        <div class="content is-clearfix" id="bio" v-else>Artist biography not found / not scraped</div>\n                        <div class="columns">\n                            <div class="column is-half is-full-mobile">\n                                <spieldose-dashboard-toplist v-if="activeTab == \'overview\' && artist.name" v-bind:type="\'topTracks\'" v-bind:title="$t(\'dashboard.labels.topPlayedTracks\')" v-bind:listItemCount="10" v-bind:showPlayCount="true" :key="$route.params.artist" v-bind:artist="$route.params.artist"></spieldose-dashboard-toplist>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="panel" v-if="activeTab == \'bio\'">\n                        <div class="content is-clearfix" id="bio" v-html="artist.bio"></div>\n                    </div>\n                    <div class="panel" v-if="activeTab == \'tracks\'">\n                        <div class="field has-addons">\n                            <div class="control is-expanded has-icons-left" v-bind:class="loadingTracks ? \'is-loading\': \'\'">\n                                <input class="input" :disabled="loadingTracks" v-if="liveSearch" v-model.trim="nameFilter" type="text" placeholder="search by text..." v-on:keyup.esc="abortInstantSearch();" v-on:keyup="instantSearch();">\n                                <input class="input" :disabled="loadingTracks" v-else v-model.trim="nameFilter" type="text" placeholder="search by text..." v-on:keyup.enter="searchTracks();">\n                                <span class="icon is-small is-left">\n                                    <i class="fas fa-search"></i>\n                                </span>\n                            </div>\n                            <p class="control" v-if="! liveSearch">\n                                <a class="button is-info" v-on:click.prevent="searchTracks();">\n                                    <span class="icon">\n                                        <i class="fas fa-search" aria-hidden="true"></i>\n                                    </span>\n                                    <span>{{ $t("browseArtist.buttons.search") }}</span>\n                                </a>\n                            </p>\n                        </div>\n                        <spieldose-pagination v-bind:loading="loadingTracks" v-bind:data="pager" v-on:pagination-changed="onPaginationChanged"></spieldose-pagination>\n                        <table class="table is-bordered is-striped is-narrow is-fullwidth">\n                            <thead>\n                                    <tr class="is-unselectable">\n                                        <th>{{ $t("browseArtist.labels.tracksAlbumTableHeader") }}</th>\n                                        <th>{{ $t("browseArtist.labels.tracksSectionYearTableHeader") }}</th>\n                                        <th>{{ $t("browseArtist.labels.tracksSectionNumberTableHeader") }}</th>\n                                        <th>{{ $t("browseArtist.labels.tracksSectionTitleTableHeader") }}</th>\n                                        <th>{{ $t("browseArtist.labels.tracksSectionActionTableHeader") }}</th>\n                                    </tr>\n                            </thead>\n                            <tbody>\n                                <tr v-for="track, i in tracks">\n                                    <td><span>{{ track.album }}</span></td>\n                                    <td><span>{{ track.year }}</span></td>\n                                    <td>{{ track.number }}</td>\n                                    <td>\n                                        <span> {{ track.title}}</span>\n                                    </td>\n                                    <td>\n                                        <i class="cursor-pointer fa fa-play" v-bind:title="$t(\'commonLabels.playThisTrack\')" v-on:click.prevent="playerData.currentPlaylist.replace([track]);"></i>\n                                        <i class="cursor-pointer fa fa-plus-square"  v-bind:title="$t(\'commonLabels.enqueueThisTrack\')" v-on:click.prevent="playerData.currentPlaylist.enqueue([track]);"></i>\n                                        <i class="cursor-pointer fa fa-save"  v-bind:title="$t(\'commonLabels.downloadThisTrack\')" v-on:click.prevent="playerData.download(track.id);"></i>\n                                    </td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                    <div class="panel" v-if="activeTab == \'albums\'">\n                        <div class="browse-album-item" v-show="! loading" v-for="album, i in artist.albums" v-bind:key="i">\n                        <a class="play-album" v-bind:title="$t(\'commonLabels.playThisAlbum\')" v-on:click.prevent="playAlbumTracks(album.name, album.artist, album.year);">\n                                <img class="album-thumbnail" v-bind:src="album.image | getAlbumImageUrl" v-on:error="album.image = null;">\n                                <i class="fas fa-play fa-4x"></i>\n                                <img class="vinyl no-cover" src="images/vinyl.png" />\n                            </a>\n                            <div class="album-info">\n                                <p class="album-name">{{ album.name }}</p>\n                                <p class="album-year" v-show="album.year">({{ album.year }})</p>\n                            </div>\n                        </div>\n                        <div class="is-clearfix"></div>\n                    </div>\n                    <div class="panel" v-if="activeTab == \'update\'">\n                        <div class="panel-block">\n                            <div class="content is-clearfix">\n                                <div class="field is-horizontal has-addons">\n                                    <div class="field-label is-normal">\n                                        <label class="label">{{ $t("browseArtist.labels.musicBrainzSearchArtistName") }}</label>\n                                    </div>\n                                    <div class="field-body">\n                                        <div class="field is-expanded has-addons">\n                                            <div class="control has-icons-left is-expanded" v-bind:class="loading ? \'is-loading\': \'\'">\n                                                <input class="input" :disabled="loading" v-model.trim="artist.name" type="text" v-bind:placeholder="$t(\'browseArtist.labels.musicBrainzSearchArtistNamePlaceholder\')">\n                                                <span class="icon is-small is-left">\n                                                    <i class="fas fa-search"></i>\n                                                </span>\n                                            </div>\n                                            <div class="control">\n                                                <a class="button is-info" v-on:click.prevent="searchMusicBrainz();">{{ $t("browseArtist.buttons.searchOnMusicBrainz") }}</a>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class="field is-horizontal has-addons">\n                                    <div class="field-label is-normal">\n                                        <label class="label">{{ $t("browseArtist.labels.musicBrainzSearchArtistMBId") }}</label>\n                                    </div>\n                                    <div class="field-body">\n                                        <div class="field is-expanded has-addons">\n                                            <div class="control has-icons-left is-expanded" v-bind:class="loading ? \'is-loading\': \'\'">\n                                                <input class="input" :disabled="loading" v-model.trim="artist.mbid" type="text" v-bind:placeholder="$t(\'browseArtist.labels.musicBrainzSearchArtistMBIdPlaceholder\')">\n                                                <span class="icon is-small is-left">\n                                                    <i class="fas fa-search"></i>\n                                                </span>\n                                            </div>\n                                            <div class="control">\n                                                <a class="button is-info" :disabled="! (artist.name && artist.mbid)" v-on:click.prevent="overwriteMusicBrainzArtist(artist.name, artist.mbid);">{{ $t("browseArtist.buttons.save") }}</a>\n                                            </div>\n                                            <div class="control">\n                                                <a class="button is-danger" v-on:click.prevent="clearMusicBrainzArtist(artist.name, artist.mbid);">{{ $t("browseArtist.buttons.clear") }}</a>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <spieldose-api-error-component v-if="hasAPIErrors" v-bind:apiError="apiError"></spieldose-api-error-component>\n        </div>\n    ',mixins:[mixinAPIError,mixinPlayer,mixinPagination,mixinLiveSearches,mixinArtists,mixinAlbums],data:function(){return{loading:!1,loadingTracks:!1,artist:{},activeTab:"overview",truncatedBio:null,detailedView:!1,tracks:[],nameFilter:null,timeout:null,updateArtistName:null,updateArtistMBId:null}},watch:{$route(a,s){switch(a.name){case"artistBio":this.getArtist(a.params.artist),this.activeTab="bio";break;case"artistTracks":case"artistTracksPaged":this.pager.actualPage=parseInt(a.params.page),this.searchArtistTracks(a.params.artist),this.activeTab="tracks";break;case"artistAlbums":this.getArtist(a.params.artist),this.activeTab="albums";break;case"artist":this.getArtist(a.params.artist),this.activeTab="overview";break;case"artistUpdate":this.getArtist(a.params.artist),this.activeTab="update"}}},created:function(){if(this.getArtist(this.$route.params.artist),"artistTracks"==this.$route.name||"artistTracksPaged"==this.$route.name)this.$route.params.page&&(this.pager.actualPage=parseInt(this.$route.params.page)),this.searchArtistTracks(this.$route.params.artist),this.activeTab="tracks";else switch(this.$route.name){case"artistBio":this.activeTab="bio";break;case"artistAlbums":this.activeTab="albums";break;case"artistUpdate":this.activeTab="update";break;default:this.activeTab="overview"}},methods:{onPaginationChanged:function(a){this.$router.push({name:"artistTracksPaged",params:{page:a}})},getArtist:function(a){this.loading=!0,this.errors=!1,spieldoseAPI.artist.get(a,(a=>{a.ok?(this.artist=a.body.artist,this.artist.bio&&(this.artist.bio=this.artist.bio.replace(/(?:\r\n|\r|\n)/g,"<br />"),this.truncatedBio=this.truncate(this.artist.bio)),this.loading=!1):(this.errors=!0,this.apiError=a.getApiErrorData(),this.loading=!1)}))},abortInstantSearch:function(){this.nameFilter=null,clearTimeout(this.timeout)},instantSearch:function(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((function(){this.pager.actualPage=1,this.searchArtistTracks(this.$route.params.artist)}),256)},searchTracks:function(){this.searchArtistTracks(this.$route.params.artist)},searchArtistTracks:function(a){this.loading=!0,this.loadingTracks=!0,this.clearAPIErrors();let s=this.nameFilter?this.nameFilter:"";spieldoseAPI.track.searchTracks(s,a,"",!1,this.pager.actualPage,this.pager.resultsPage,"",(a=>{a.ok?(this.pager.actualPage=a.body.actualPage,this.pager.totalPages=a.body.totalPages,this.pager.totalResults=a.body.totalResults,a.body.tracks&&a.body.tracks.length>0?this.tracks=a.body.tracks:this.tracks=[]):this.setAPIError(a.getApiErrorData()),this.loadingTracks=!1,this.loading=!1}))},changeTab:function(a){this.activeTab=a},truncate:function(a){return a.substring(0,500)},enqueueAlbumTracks:function(a,s,i){this.loading=!0,this.clearAPIErrors(),spieldoseAPI.track.getAlbumTracks(a||null,s||null,i||null,(a=>{this.playerData.currentPlaylist.empty(),a.ok?a.body.tracks&&a.body.tracks.length>0&&(this.playerData.tracks=a.body.tracks,this.playerData.playback.play()):this.setAPIError(a.getApiErrorData()),this.loading=!1}))},searchMusicBrainz(a){window.open("https://musicbrainz.org/search?query="+encodeURI(this.artist.name)+"&type=artist&limit=16&method=indexed")},overwriteMusicBrainzArtist(a,s){this.loading=!0,this.errors=!1,spieldoseAPI.artist.overwriteMusicBrainz(a,s,(a=>{a.ok||this.setAPIError(a.getApiErrorData()),this.loading=!1}))},clearMusicBrainzArtist:function(a,s){this.loading=!0,this.errors=!1,spieldoseAPI.artist.clearMusicBrainz(a,s,(a=>{a.ok||this.setAPIError(a.getApiErrorData()),this.loading=!1}))}}};
import{bus}from"./bus.js";import{default as spieldoseAPI}from"./api.js";import{default as sharedPlayerData}from"./playerData.js";import{default as getValidator}from"./validator.js";export const mixinLiveSearches={computed:{liveSearch:function(){return initialState.liveSearch}}};export const mixinAlbums={filters:{getAlbumImageUrl:function(t){return t?0==t.indexOf("http")?"api/thumbnail?url="+encodeURIComponent(t):"api/thumbnail?hash="+t:"images/image-album-not-set.png"}}};export const mixinArtists={filters:{getArtistImageUrl:function(t){return t?"api/thumbnail?url="+t:"images/image-artist-not-set.png"}}};export const mixinPlayer={data:function(){return{playerData:sharedPlayerData,currentPlayedSeconds:null,volume:1,songProgress:0}},computed:{isPlaying:function(){return this.playerData.isPlaying},isPaused:function(){return this.playerData.isPaused},isMuted:function(){return!1},isStopped:function(){return this.playerData.isStopped},nowPlayingTitle:function(){return this.isPlaying||this.isPaused?this.playerData.currentTrack.track.title?this.playerData.currentTrack.track.title:"track title unknown":"track title"},nowPlayingSeconds:function(){return this.currentPlayedSeconds},nowPlayingLength:function(){return(this.isPlaying||this.isPaused)&&this.playerData.currentTrack.track.playtimeString?this.playerData.currentTrack.track.playtimeString:"00:00"},nowPlayingArtist:function(){return this.isPlaying||this.isPaused?this.playerData.currentTrack.track.artist?this.playerData.currentTrack.track.artist:"artist unknown":"artist"},nowPlayingArtistAlbum:function(){return this.isPlaying||this.isPaused?this.playerData.currentTrack.track.album?" / "+this.playerData.currentTrack.track.album:"album unknown":"album"},nowPlayingYear:function(){return this.isPlaying||this.isPaused?this.playerData.currentTrack.track.year?" ("+this.playerData.currentTrack.track.year+")":" (year unknown)":" (year)"},nowPlayingLoved:function(){return this.playerData.currentTrack.track&&"1"==this.playerData.currentTrack.track.loved}},filters:{formatSeconds:function(t){return function(t,a){const r=Math.floor(t/3600);let e=Math.floor((t-3600*r)/60),i=Math.floor(t-3600*r-60*e);return e<10&&(e="0"+e),i<10&&(i="0"+i),e+":"+i}(t)}},methods:{playPathTracks:function(t){this.clearAPIErrors(),spieldoseAPI.track.getPathTracks(t,(t=>{t.ok?t.body.tracks&&t.body.tracks.length>0&&this.playerData.currentPlaylist.replace(t.body.tracks):this.setAPIError(t.getApiErrorData())}))},enqueuePathTracks:function(t){this.clearAPIErrors(),spieldoseAPI.track.getPathTracks(t,(t=>{t.ok?t.body.tracks&&t.body.tracks.length>0&&this.playerData.currentPlaylist.enqueue(t.body.tracks):this.setAPIError(t.getApiErrorData())}))},playAlbumTracks:function(t,a,r){this.clearAPIErrors(),spieldoseAPI.track.getAlbumTracks(t||null,a||null,r||null,(t=>{this.playerData.currentPlaylist.empty(),t.ok?t.body.tracks&&t.body.tracks.length>0&&(this.playerData.tracks=t.body.tracks,this.playerData.playback.play()):this.setAPIError(t.getApiErrorData())}))},enqueueAlbumTracks:function(t,a,r){this.clearAPIErrors(),spieldoseAPI.track.getAlbumTracks(t||null,a||null,r||null,(t=>{t.ok?t.body.tracks&&t.body.tracks.length>0&&this.playerData.currentPlaylist.enqueue(t.body.tracks):this.setAPIError(t.getApiErrorData())}))},playPlaylistTracks:function(t){this.clearAPIErrors(),t?spieldoseAPI.playlist.get(t,(a=>{a.ok?(this.playerData.currentPlaylist.replace(a.body.playlist.tracks),this.playerData.currentPlaylist.set(t,a.body.playlist.name)):this.setAPIError(a.getApiErrorData())})):spieldoseAPI.track.searchTracks("","","",!0,1,0,"random",(t=>{t.ok?(this.playerData.currentPlaylist.replace(t.body.tracks),this.playerData.currentPlaylist.unset()):this.setAPIError(t.getApiErrorData())}))},enqueuePlaylistTracks:function(t){this.clearAPIErrors(),t?spieldoseAPI.playlist.get(t,(t=>{t.ok?this.playerData.currentPlaylist.enqueue(t.body.playlist.tracks):this.setAPIError(t.getApiErrorData())})):spieldoseAPI.track.searchTracks("","","",!0,1,0,"random",(t=>{t.ok?this.playerData.currentPlaylist.enqueue(t.body.tracks):this.setAPIError(t.getApiErrorData())}))},playTrack:function(t){this.playerData.currentPlaylist.replace([t])},enqueueTrack:function(t){this.playerData.currentPlaylist.enqueue([t])},playRadioStation:function(t){this.clearAPIErrors(),spieldoseAPI.radioStation.get(t,(t=>{if(t.ok){let a={title:t.body.radioStation.name,artist:this.$t("commonLabels.remoteRadioStation"),radioStation:t.body.radioStation};this.playerData.currentPlaylist.replace([a])}else this.setAPIError(t.getApiErrorData())}))}}};export const mixinValidations={data:function(){return{validator:getValidator}}};export const mixinAPIError={data:function(){return{apiError:null}},computed:{hasAPIErrors(){return null!=this.apiError}},methods:{clearAPIErrors(){this.apiError=null},setAPIError(t){this.apiError=t}}};export const mixinPagination={data:function(){return{pager:{actualPage:1,previousPage:1,nextPage:1,totalPages:0,resultsPage:initialState.defaultResultsPage}}},created:function(){this.$route.params.page&&(this.pager.actualPage=parseInt(this.$route.params.page)),"function"==typeof this.search&&this.search()},watch:{$route(t,a){t.params.page&&(this.pager.actualPage=parseInt(t.params.page),"function"==typeof this.search&&this.search())}}};export const mixinTopRecentCharts={data:function(){return{items:[]}},created:function(){this.load()},computed:{hasItems:function(){return this.items&&this.items.length>0}},methods:{playTrack:function(t){this.playerData.currentPlaylist.replace([t])},enqueueTrack:function(t){this.playerData.currentPlaylist.enqueue([t])}}};export const mixinNavigation={methods:{isSectionActive:function(t){return this.$route.name==t},changeSection:function(t){this.$router.push({name:t}).catch((t=>{}))},navigateToArtistPage:function(t){t&&this.$router.push({name:"artist",params:{artist:t}})}}};export const mixinSession={methods:{signout:function(){bus.$emit("signOut")}}};
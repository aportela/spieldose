"use strict";(globalThis["webpackChunkspieldose"]=globalThis["webpackChunkspieldose"]||[]).push([[740],{8740:(e,l,a)=>{a.r(l),a.d(l,{default:()=>Z});var t=a(9835),r=a(499),s=a(6970),n=a(1957),i=a(9302),o=a(796),u=a(6647),d=a(1569),c=a(4867),m=a(5090),p=a(8106);const v=(0,t._)("div",{class:"text-h6"},"Save current playlist",-1),b={__name:"CurrentPlaylistPage",setup(e){const l=(0,i.Z)(),{t:a}=(0,u.QT)(),b=(0,m.H)(),f=(0,r.iH)(null),g=(0,r.iH)([]),k=[{name:"index",required:!0,label:"Index",align:"right",field:e=>e.index,sortable:!1},{name:"title",required:!0,label:"Title",align:"left",field:e=>e.title,sortable:!1},{name:"artist",required:!0,label:"Artist",align:"left",field:e=>e.artist.name,sortable:!1},{name:"albumArtist",required:!1,label:"Album artist",align:"left",field:e=>e.album.artist.name,sortable:!1},{name:"albumTitle",required:!1,label:"Album",align:"left",field:e=>e.album.title,sortable:!1},{name:"albumTrackIndex",required:!1,label:"Album Track nÂº",align:"right",field:e=>e.trackNumber,sortable:!1},{name:"year",required:!1,label:"Year",align:"right",field:e=>e.album.year,sortable:!1},{name:"actions",required:!0,label:"Actions",align:"center",favorited:e=>e.favorited}],w=(0,t.Fl)((()=>b.isPlaying?"play_arrow":b.isPaused?"pause":b.isStopped?"stop":"play_arrow")),y=(0,r.iH)(0);let h=[];const x=(0,r.iH)(!1),P=(0,r.iH)(!1),S=(0,r.iH)({id:null,name:null,public:!1}),U=(0,t.f3)("bus");function C(){b.interact(),b.stop(),p.jZ.clear(),g.value=[]}function I(e){let t=Array.from({length:g.value.length},((e,l)=>l));t.splice(e,1),t.splice(e-1,0,e),p.jZ.resortByIndexes(t).then((e=>{g.value=e.data.tracks.map(((e,l)=>(e.index=l+1,e))),h.value=e.data.shuffledIndexes,y.value=A.value,x.value=!1})).catch((e=>{l.notify({type:"negative",message:a("API Error: error resorting tracks"),caption:a("API Error: fatal error details",{status:e&&e.response?e.response.status:"undefined",statusText:e&&e.response?e.response.statusText:"undefined"})}),x.value=!1}))}function W(e){let t=Array.from({length:g.value.length},((e,l)=>l));t.splice(e,1),t.splice(e+1,0,e),p.jZ.resortByIndexes(t).then((e=>{g.value=e.data.tracks.map(((e,l)=>(e.index=l+1,e))),h.value=e.data.shuffledIndexes,y.value=A.value,x.value=!1})).catch((e=>{l.notify({type:"negative",message:a("API Error: error resorting tracks"),caption:a("API Error: fatal error details",{status:e&&e.response?e.response.status:"undefined",statusText:e&&e.response?e.response.statusText:"undefined"})}),x.value=!1}))}function _(e,t,r){const s=r?p.dC.unSetFavorite:p.dC.setFavorite;s(t,"CurrentPlaylistPage").then((l=>{g.value[e-1].favorited=l.data.favorited})).catch((e=>{switch(e.response.status){default:l.notify({type:"negative",message:a("API Error: error toggling favorite flag"),caption:a("API Error: fatal error details",{status:e.response.status,statusText:e.response.statusText})});break}}))}function q(e){x.value=!0,p.jZ.removeElementAtIndex(e).then((e=>{g.value=e.data.tracks.map(((e,l)=>(e.index=l+1,e))),h.value=e.data.shuffledIndexes,y.value=A.value,x.value=!1})).catch((e=>{switch(e.response.status){default:l.notify({type:"negative",message:a("API Error: error removing element"),caption:a("API Error: fatal error details",{status:e.response.status,statusText:e.response.statusText})});break}x.value=!1}))}function T(e,l,a){"A"!=e.target.nodeName&&"I"!=e.target.nodeName&&"BUTTON"!=e.target.nodeName&&(b.interact(),p.jZ.skipToElementIndex(a).then((e=>{})).catch((e=>{})))}function z(){x.value=!0,p.jZ.get().then((e=>{g.value=e.data.tracks.map(((e,l)=>(e.index=l+1,e))),h.value=e.data.shuffledIndexes,y.value=b.getShuffle?h.value[e.data.currentIndex]:e.data.currentIndex,x.value=!1})).catch((e=>{x.value=!1}))}U.on(c.spieldoseEventNames.track.setFavorite,(e=>{if("CurrentPlaylistPage"!=e.source&&g?.value.length>0){const l=g.value.findIndex((l=>l&&l.id==e.id));-1!==l&&(g.value[l].favorited=e.timestamp)}})),U.on(c.spieldoseEventNames.track.unSetFavorite,(e=>{if("CurrentPlaylistPage"!=e.source&&g?.value.length>0){const l=g.value.findIndex((l=>l&&l.id==e.id));-1!==l&&(g.value[l].favorited=null)}}));const A=(0,t.Fl)((()=>b.getShuffle?b.getCurrentPlaylistShuffledIndex:b.getCurrentPlaylistIndex));function Z(){b.stop(),x.value=!0,p.jZ.randomize().then((e=>{g.value=e.data.tracks.map(((e,l)=>(e.index=l+1,e))),h.value=e.data.shuffledIndexes,y.value=A.value,x.value=!1})).catch((e=>{l.notify({type:"negative",message:a("API Error: error loading random tracks"),caption:a("API Error: fatal error details",{status:e&&e.response?e.response.status:"undefined",statusText:e&&e.response?e.response.statusText:"undefined"})}),x.value=!1}))}function E(){b.stop(),x.value=!0,p.jZ.discover(32).then((e=>{g.value=e.data.tracks.map(((e,l)=>(e.index=l+1,e))),h.value=e.data.shuffledIndexes,y.value=A.value,x.value=!1})).catch((e=>{l.notify({type:"negative",message:a("API Error: error loading random tracks"),caption:a("API Error: fatal error details",{status:e&&e.response?e.response.status:"undefined",statusText:e&&e.response?e.response.statusText:"undefined"})}),x.value=!1}))}function j(){b.interact(),p.jZ.skipToPreviousElement().then((e=>{})).catch((e=>{}))}function Q(){b.interact(),b.play()}function N(){b.interact(),b.play()}function V(){b.interact(),b.play()}function L(){b.stop(),b.setCurrentTime(0)}function B(){b.interact(),p.jZ.skipToNextElement().then((e=>{})).catch((e=>{}))}function H(){b.getCurrentPlaylistLinkedPlaylist?(console.log("hya plyalist"),b.getCurrentPlaylistLinkedPlaylist.allowUpdate?(console.log("se puede actualizar"),S.value=b.getCurrentPlaylistLinkedPlaylist):S.value={id:(0,o.Z)(),name:b.getCurrentPlaylistLinkedPlaylist.name,public:!1,allowUpdate:!0}):S.value={id:(0,o.Z)(),name:null,public:!1,allowUpdate:!0},P.value=!0}function D(){const e=g.value.map((e=>e.id));b.interact(),x.value=!0;const t=b.getCurrentPlaylistLinkedPlaylist?d.api.playlist.update:d.api.playlist.add;t(S.value.id,S.value.name,e,S.value.public).then((e=>{b.data.currentPlaylist.playlist=S.value,x.value=!1,P.value=!1})).catch((e=>{l.notify({type:"negative",message:a("API Error: error loading random tracks"),caption:a("API Error: fatal error details",{status:e&&e.response?e.response.status:"undefined",statusText:e&&e.response?e.response.statusText:"undefined"})}),x.value=!1}))}return(0,t.YP)(A,(e=>{y.value=e,f.value.scrollTo(e,"center-force")})),y.value=A.value,(0,t.bv)((()=>{z(),y.value>0&&f.value.scrollTo(y.value,"center-force")})),(e,i)=>{const o=(0,t.up)("q-breadcrumbs-el"),u=(0,t.up)("q-breadcrumbs"),d=(0,t.up)("q-btn"),c=(0,t.up)("q-btn-group"),m=(0,t.up)("q-icon"),p=(0,t.up)("q-td"),h=(0,t.up)("router-link"),U=(0,t.up)("q-tr"),z=(0,t.up)("q-table"),A=(0,t.up)("q-card-section"),F=(0,t.up)("q-input"),R=(0,t.up)("q-toggle"),M=(0,t.up)("q-card-actions"),Y=(0,t.up)("q-card"),G=(0,t.up)("q-dialog"),K=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(Y,{class:"q-pa-lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{class:"q-mb-lg"},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{icon:"home",label:"Spieldose"}),(0,t.Wm)(o,{icon:"list_alt",label:(0,r.SU)(a)("Current playlist")},null,8,["label"]),(0,r.SU)(b).getCurrentPlaylistLinkedPlaylist?((0,t.wg)(),(0,t.j4)(o,{key:0,label:(0,r.SU)(b).getCurrentPlaylistLinkedPlaylist.name},null,8,["label"])):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(c,{spread:"",class:"q-mb-md"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{size:"md",outline:"",color:"dark",label:(0,r.SU)(l).screen.gt.md?(0,r.SU)(a)("Clear"):"",icon:"clear",onClick:C,disable:x.value||!(g.value?.length>0)},null,8,["label","disable"]),(0,t.Wm)(d,{size:"md",outline:"",color:"dark",label:(0,r.SU)(l).screen.gt.md?(0,r.SU)(a)("Discover"):"",icon:"bolt",onClick:E,disable:x.value},null,8,["label","disable"]),(0,t.Wm)(d,{size:"md",outline:"",color:"dark",label:(0,r.SU)(l).screen.gt.md?(0,r.SU)(a)("Randomize"):"",icon:"shuffle",onClick:Z,disable:x.value||!(g.value?.length>0)},null,8,["label","disable"]),(0,t.Wm)(d,{size:"md",outline:"",color:"dark",label:(0,r.SU)(l).screen.gt.md?(0,r.SU)(a)("Previous"):"",icon:"skip_previous",onClick:j,disable:x.value||!(0,r.SU)(b).allowSkipPrevious},null,8,["label","disable"]),(0,r.SU)(b).isStopped?((0,t.wg)(),(0,t.j4)(d,{key:0,size:"md",outline:"",color:"dark",label:(0,r.SU)(l).screen.gt.md?(0,r.SU)(a)("Play"):"",icon:"play_arrow",onClick:Q,disable:x.value||!(0,r.SU)(b).hasCurrentPlaylistElements},null,8,["label","disable"])):(0,r.SU)(b).isPlaying?((0,t.wg)(),(0,t.j4)(d,{key:1,size:"md",outline:"",color:"dark",label:(0,r.SU)(l).screen.gt.md?(0,r.SU)(a)("Pause"):"",icon:"pause",onClick:N,disable:x.value||!(g.value?.length>0)},null,8,["label","disable"])):(0,r.SU)(b).isPaused?((0,t.wg)(),(0,t.j4)(d,{key:2,size:"md",outline:"",color:"dark",label:(0,r.SU)(l).screen.gt.md?(0,r.SU)(a)("Resume"):"",icon:"play_arrow",onClick:V,disable:x.value||!(g.value?.length>0)},null,8,["label","disable"])):(0,t.kq)("",!0),(0,t.Wm)(d,{size:"md",outline:"",color:"dark",label:(0,r.SU)(l).screen.gt.md?(0,r.SU)(a)("Stop"):"",icon:"stop",onClick:L,disable:x.value||(0,r.SU)(b).isStopped||!(g.value?.length>0)},null,8,["label","disable"]),(0,t.Wm)(d,{size:"md",outline:"",color:"dark",label:(0,r.SU)(l).screen.gt.md?(0,r.SU)(a)("Next"):"",icon:"skip_next",onClick:B,disable:x.value||!(0,r.SU)(b).allowSkipNext},null,8,["label","disable"]),(0,t.Wm)(d,{size:"md",outline:"",color:"dark",label:(0,r.SU)(l).screen.gt.md?(0,r.SU)(a)("Download"):"",icon:"save_alt",disable:x.value||!(0,r.SU)(b).isCurrentPlaylistElementATrack,href:(0,r.SU)(b).isCurrentPlaylistElementATrack?(0,r.SU)(b).getCurrentPlaylistElementURL:"#"},null,8,["label","disable","href"]),(0,t.Wm)(d,{size:"md",outline:"",color:"dark",label:(0,r.SU)(l).screen.gt.md?(0,r.SU)(a)("Save as"):"",icon:"save_alt",disable:x.value||!(g.value?.length>0),onClick:H},null,8,["label","disable"])])),_:1}),(0,t.Wm)(z,{ref_key:"tableRef",ref:f,class:"my-sticky-header-table",style:{height:"46.2em"},rows:g.value,columns:k,"row-key":"id","virtual-scroll":"","rows-per-page-options":[0],"hide-bottom":!0},{body:(0,t.w5)((e=>[(0,t.Wm)(U,{class:(0,s.C_)(["cursor-pointer",{"selected-row":y.value+1==e.row.index}]),props:e,onClick:l=>T(l,e.row,e.row.index-1)},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{key:"index",props:e},{default:(0,t.w5)((()=>[y.value+1==e.row.index?((0,t.wg)(),(0,t.j4)(m,{key:0,name:w.value,color:"pink",size:"sm",class:"q-mr-sm"},null,8,["name"])):(0,t.kq)("",!0),(0,t.Uk)(" "+(0,s.zw)(e.row.index)+" / "+(0,s.zw)(g.value.length),1)])),_:2},1032,["props"]),(0,t.Wm)(p,{key:"title",props:e},{default:(0,t.w5)((()=>[(0,t.Uk)((0,s.zw)(e.row.title),1)])),_:2},1032,["props"]),(0,t.Wm)(p,{key:"artist",props:e},{default:(0,t.w5)((()=>[e.row.artist.name?((0,t.wg)(),(0,t.j4)(h,{key:0,class:(0,s.C_)({"text-white text-bold":!1}),to:{name:"artist",params:{name:e.row.artist.name},query:{mbid:e.row.artist.mbId,tab:"overview"}}},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{name:"link",class:"q-mr-sm"}),(0,t.Uk)((0,s.zw)(e.row.artist.name),1)])),_:2},1032,["to"])):(0,t.kq)("",!0)])),_:2},1032,["props"]),(0,t.Wm)(p,{key:"albumArtist",props:e},{default:(0,t.w5)((()=>[e.row.album.artist.name?((0,t.wg)(),(0,t.j4)(h,{key:0,class:(0,s.C_)({"text-white text-bold":!1}),to:{name:"artist",params:{name:e.row.album.artist.name},query:{mbid:e.row.album.artist.mbId,tab:"overview"}}},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{name:"link",class:"q-mr-sm"}),(0,t.Uk)((0,s.zw)(e.row.album.artist.name),1)])),_:2},1032,["to"])):(0,t.kq)("",!0)])),_:2},1032,["props"]),(0,t.Wm)(p,{key:"albumTitle",props:e},{default:(0,t.w5)((()=>[e.row.album.title?((0,t.wg)(),(0,t.j4)(h,{key:0,class:(0,s.C_)({"text-white text-bold":!1}),to:{name:"album",params:{title:e.row.album.title},query:{mbId:e.row.album.mbId,artistMbId:e.row.album.artist.mbId,artistName:e.row.album.artist.name,year:e.row.album.year}}},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{name:"link",class:"q-mr-sm"}),(0,t.Uk)((0,s.zw)(e.row.album.title),1)])),_:2},1032,["to"])):(0,t.kq)("",!0)])),_:2},1032,["props"]),(0,t.Wm)(p,{key:"albumTrackIndex",props:e},{default:(0,t.w5)((()=>[(0,t.Uk)((0,s.zw)(e.row.trackNumber),1)])),_:2},1032,["props"]),(0,t.Wm)(p,{key:"year",props:e},{default:(0,t.w5)((()=>[(0,t.Uk)((0,s.zw)(e.row.album.year),1)])),_:2},1032,["props"]),(0,t.Wm)(p,{key:"actions",props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{outline:""},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{size:"sm",color:"white","text-color":"grey-5",icon:"north",title:(0,r.SU)(a)("Up"),disable:1==e.row.index||e.row.id==y.value,onClick:l=>I(e.row.index-1)},null,8,["title","disable","onClick"]),(0,t.Wm)(d,{size:"sm",color:"white","text-color":"grey-5",icon:"south",title:(0,r.SU)(a)("Down"),disable:e.row.index==g.value.length||e.row.id==y.value,onClick:l=>W(e.row.index-1)},null,8,["title","disable","onClick"]),(0,t.Wm)(d,{size:"sm",color:"white","text-color":"grey-5",icon:"delete",title:(0,r.SU)(a)("Remove"),onClick:(0,n.iM)((l=>q(e.row.index-1)),["stop","prevent"])},null,8,["title","onClick"]),(0,t.Wm)(d,{size:"sm",color:"white","text-color":e.row.favorited?"pink":"grey-5",icon:"favorite",title:(0,r.SU)(a)("Toggle favorite"),onClick:l=>_(e.row.index,e.row.id,e.row.favorited)},null,8,["text-color","title","onClick"]),(0,t.Wm)(d,{size:"sm",color:"white","text-color":"grey-5",icon:"save_alt",title:(0,r.SU)(a)("Download"),href:e.row.url},null,8,["title","href"])])),_:2},1024)])),_:2},1032,["props"])])),_:2},1032,["props","onClick","class"])])),_:1},8,["rows"]),(0,t.Wm)(G,{modelValue:P.value,"onUpdate:modelValue":i[3]||(i[3]=e=>P.value=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(Y,{style:{"min-width":"350px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(A,null,{default:(0,t.w5)((()=>[v])),_:1}),(0,t.Wm)(A,{class:"q-pt-none"},{default:(0,t.w5)((()=>[(0,t.Wm)(F,{outlined:"",dense:"",modelValue:S.value.name,"onUpdate:modelValue":i[0]||(i[0]=e=>S.value.name=e),autofocus:"",onKeyup:i[1]||(i[1]=(0,n.D2)((e=>P.value=!1),["enter"])),label:"Playlist name"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(A,{class:"q-pt-none"},{default:(0,t.w5)((()=>[(0,t.Wm)(R,{label:"Public",color:"pink",modelValue:S.value.public,"onUpdate:modelValue":i[2]||(i[2]=e=>S.value.public=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(M,{align:"right",class:""},{default:(0,t.w5)((()=>[(0,t.wy)((0,t.Wm)(d,{outline:"",label:"Cancel"},null,512),[[K]]),(0,t.Wm)(d,{outline:"",label:"Save",disable:!S.value.name,onClick:D},null,8,["disable"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}}};var f=a(4458),g=a(2605),k=a(8052),w=a(7236),y=a(8879),h=a(9994),x=a(1233),P=a(7220),S=a(2857),U=a(7743),C=a(3190),I=a(6611),W=a(3175),_=a(1821),q=a(2146),T=a(9984),z=a.n(T);const A=b,Z=A;z()(b,"components",{QCard:f.Z,QBreadcrumbs:g.Z,QBreadcrumbsEl:k.Z,QBtnGroup:w.Z,QBtn:y.Z,QTable:h.Z,QTr:x.Z,QTd:P.Z,QIcon:S.Z,QDialog:U.Z,QCardSection:C.Z,QInput:I.Z,QToggle:W.Z,QCardActions:_.Z}),z()(b,"directives",{ClosePopup:q.Z})}}]);
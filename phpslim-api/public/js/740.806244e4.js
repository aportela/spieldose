"use strict";(globalThis["webpackChunkspieldose"]=globalThis["webpackChunkspieldose"]||[]).push([[740],{8106:(e,l,t)=>{t.d(l,{dC:()=>o,oS:()=>u});var a=t(6223),n=t(2719),s=t(1569),r=t(4867);const i=(0,n.d)(),o={setFavorite:function(e){return new Promise(((l,t)=>{s.api.track.setFavorite(e).then((t=>{r.spieldoseEvents.emit.track.setFavorite(e,t.data.favorited),l(t)})).catch((e=>{t(e)}))}))},unSetFavorite:function(e){return new Promise(((l,t)=>{s.api.track.unSetFavorite(e).then((t=>{r.spieldoseEvents.emit.track.unSetFavorite(e),l(t)})).catch((e=>{t(e)}))}))},play:function(e){a.spieldosePlayer.interact(),a.spieldosePlayer.isStopped()||a.spieldosePlayer.actions.stop(),i.saveElements(Array.isArray(e)?e:[{track:e}]),a.spieldosePlayer.actions.play(!0)},enqueue:function(e){player.interact(),i.appendElements(Array.isArray(e)?e:[{track:e}])}},u={saveElements:function(e){i.saveElements(e)},appendElements:function(e){i.appendElements(e)},clear:function(){i.clear()},skipPrevious:function(){i.skipPrevious()},skipNext:function(){i.skipNext()}}},2719:(e,l,t)=>{t.d(l,{d:()=>o});var a=t(1809),n=t(8612),s=t.n(n),r=t(6223);const i={namespace:"spieldose",storages:["local","cookie","session","memory"],storage:"local",expireDays:3650},o=(0,a.Q_)("currentPlaylist",{state:()=>({elements:[],shuffleIndexes:[],currentIndex:-1,elementsLastChangeTimestamp:null}),getters:{hasElements:e=>e.elements&&e.elements.length>0,getElements:e=>e.elements,elementCount:e=>e.elements?e.elements.length:0,getElementsLastChangeTimestamp:e=>e.elementsLastChangeTimestamp,getCurrentIndex:e=>r.spieldosePlayer.getShuffle()?e.shuffleIndexes[e.currentIndex]:e.currentIndex,getCurrentElement:e=>e.currentIndex>=0&&e.elements.length>0?e.elements[e.currentIndex]:null,getCurrentElementURL:e=>e.currentIndex>=0&&e.elements.length>0?e.elements[e.currentIndex].url:null,allowSkipPrevious:e=>e.currentIndex>0&&e.elements.length>0,allowSkipNext:e=>e.currentIndex>=0&&e.elements.length>0&&e.currentIndex<e.elements.length-1,allowPlay:e=>!0,allowPause:e=>!0,allowResume:e=>!0,allowStop:e=>!0},actions:{load(){const e=s()(i),l=e.get("currentPlaylistElements");l&&(this.elements=l);const t=e.get("shuffleIndexes");t&&(this.shuffleIndexes=t);const a=e.get("currentPlaylistElementIndex");a>=0&&(this.currentIndex=a)},saveCurrentElements(){const e=s()(i);e.set("currentPlaylistElements",this.elements),e.set("currentPlaylistElementIndex",this.currentIndex),e.set("shuffleIndexes",this.shuffleIndexes),this.elementsLastChangeTimestamp=Date.now()},saveElements(e){this.elements=e,this.shuffleIndexes=[...Array(e.length).keys()].sort((function(){return.5-Math.random()})),this.currentIndex=e&&e.length>0?0:-1,this.saveCurrentElements()},appendElements(e){this.elements=this.elements.concat(e),this.saveCurrentElements()},saveCurrentTrackIndex(e){this.currentIndex=e>=0?e:-1;const l=s()(i);l.set("currentPlaylistElementIndex",this.currentIndex)},skipPrevious(){this.saveCurrentTrackIndex(--this.currentIndex)},skipNext(){this.saveCurrentTrackIndex(++this.currentIndex)},clear(){this.elements=[],this.saveCurrentElements()}}})},8740:(e,l,t)=>{t.r(l),t.d(l,{default:()=>Q});var a=t(9835),n=t(499),s=t(6970),r=t(1957),i=t(9302),o=t(796),u=t(6647),c=t(1569),d=t(2719),m=t(8106);const p=(0,a._)("div",{class:"text-h6"},"Save current playlist",-1),v={__name:"CurrentPlaylistPage",setup(e){const l=(0,i.Z)(),{t}=(0,u.QT)(),v=(0,a.f3)("spieldosePlayer"),b=(0,d.d)(),k=(0,a.Fl)((()=>b.getElementsLastChangeTimestamp)),g=(0,n.iH)(null),f=(0,n.iH)([]),h=[{name:"index",required:!0,label:"Index",align:"right",field:e=>e.index,sortable:!1},{name:"title",required:!0,label:"Title",align:"left",field:e=>e.title,sortable:!0},{name:"artist",required:!0,label:"Artist",align:"left",field:e=>e.artist.name,sortable:!0},{name:"albumArtist",required:!1,label:"Album artist",align:"left",field:e=>e.album.artist.name,sortable:!0},{name:"albumTitle",required:!1,label:"Album",align:"left",field:e=>e.album.title,sortable:!0},{name:"albumTrackIndex",required:!1,label:"Album Track nÂº",align:"right",field:e=>e.trackNumber,sortable:!0},{name:"year",required:!1,label:"Year",align:"right",field:e=>e.album.year,sortable:!0},{name:"actions",required:!0,label:"Actions",align:"center",favorited:e=>e.favorited}],w=(0,n.iH)(h.map((e=>e.name))),y=((0,n.iH)({descending:!1,page:1,rowsPerPage:64}),(0,a.Fl)((()=>v.isPlaying()?"play_arrow":v.isPaused()?"pause":v.isStopped()?"stop":"play_arrow")));(0,a.YP)(k,(e=>{x.value=b.getElements,f.value=x.value.map(((e,l)=>(e.track.index=l+1,e.track))),C.value=b.getCurrentIndex}));const x=(0,n.iH)([]),C=(0,n.iH)(0),S=(0,n.iH)(!1),U=(0,n.iH)(!1),I=(0,n.iH)(null),P=(0,n.iH)(!1);function W(){v.actions.stop(),x.value=[],f.value=[],b.clear()}function _(e){const l=x.value[e];x.value.splice(e,1),x.value.splice(e-1,0,l)}function E(e){const l=x.value[e];x.value.splice(e,1),x.value.splice(e+1,0,l)}function q(e,a){const n=a?m.dC.unSetFavorite:m.dC.setFavorite;n(e).then((e=>{})).catch((e=>{switch(e.response.status){default:l.notify({type:"negative",message:t("API Error: error when toggling favorite flag"),caption:t("API Error: fatal error details",{status:e.response.status,statusText:e.response.statusText})});break}}))}function T(e){x.value.splice(e,1),f.value=x.value.map(((e,l)=>(e.track.index=l+1,e.track))),b.saveElements(x.value)}function z(e,l,t){"I"!=e.target.nodeName&&"BUTTON"!=e.target.nodeName&&(v.interact(),b.saveCurrentTrackIndex(t),v.isPlaying()||v.actions.play())}function A(){v.interact(),S.value=!0,C.value=0,c.api.track.search({},1,32,!0,null,null).then((e=>{x.value=e.data.data.items.map((e=>({track:e}))),f.value=x.value.map(((e,l)=>(e.track.index=l+1,e.track))),m.dC.play(x.value),g.value.scrollTo(0,"center-force"),S.value=!1})).catch((e=>{l.notify({type:"negative",message:t("API Error: error loading random tracks"),caption:t("API Error: fatal error details",{status:e.response.status,statusText:e.response.statusText})}),S.value=!1}))}const Q=(0,a.Fl)((()=>b.getCurrentIndex));function Z(){v.actions.stop(),A()}function N(){v.interact(),m.oS.skipPrevious()}function F(){v.interact(),v.actions.play()}function H(){v.interact(),v.actions.play()}function V(){v.interact(),v.actions.play()}function L(){v.actions.stop(),v.actions.setCurrentTime(0)}function R(){v.interact(),b.skipNext()}function D(){I.value=null,U.value=!0}function j(){v.interact(),S.value=!0,C.value=0,c.api.playlist.add((0,o.Z)(),I.value,x.value.filter((e=>e.track)).map((e=>e.track.id)),P.value).then((e=>{S.value=!1,U.value=!1})).catch((e=>{l.notify({type:"negative",message:t("API Error: error loading random tracks"),caption:t("API Error: fatal error details",{status:e.response.status,statusText:e.response.statusText})}),S.value=!1}))}return(0,a.YP)(Q,(e=>{C.value=e,g.value.scrollTo(e,"center-force")})),x.value=b.getElements,f.value=x.value.map(((e,l)=>(e.track.index=l+1,e.track))),C.value=b.getCurrentIndex,(e,i)=>{const o=(0,a.up)("q-breadcrumbs-el"),u=(0,a.up)("q-breadcrumbs"),c=(0,a.up)("q-btn"),d=(0,a.up)("q-btn-group"),m=(0,a.up)("q-icon"),k=(0,a.up)("q-td"),A=(0,a.up)("router-link"),Q=(0,a.up)("q-tr"),B=(0,a.up)("q-table"),Y=(0,a.up)("q-card"),M=(0,a.up)("q-card-section"),G=(0,a.up)("q-input"),K=(0,a.up)("q-toggle"),O=(0,a.up)("q-card-actions"),J=(0,a.up)("q-dialog"),X=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(Y,{class:"q-pa-lg"},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{class:"q-mb-lg"},{default:(0,a.w5)((()=>[(0,a.Wm)(o,{icon:"home",label:"Spieldose"}),(0,a.Wm)(o,{icon:"list_alt",label:(0,n.SU)(t)("Current playlist")},null,8,["label"])])),_:1}),(0,a.Wm)(d,{spread:"",class:"q-mb-md"},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{size:"md",outline:"",color:"dark",label:(0,n.SU)(l).screen.gt.md?(0,n.SU)(t)("Clear"):"",icon:"clear",onClick:W,disable:S.value||!(x.value&&x.value.length>0)},null,8,["label","disable"]),(0,a.Wm)(c,{size:"md",outline:"",color:"dark",label:(0,n.SU)(l).screen.gt.md?(0,n.SU)(t)("Randomize"):"",icon:"bolt",onClick:Z,disable:S.value},null,8,["label","disable"]),(0,a.Wm)(c,{size:"md",outline:"",color:"dark",label:(0,n.SU)(l).screen.gt.md?(0,n.SU)(t)("Previous"):"",icon:"skip_previous",onClick:N,disable:S.value||!(0,n.SU)(b).allowSkipPrevious},null,8,["label","disable"]),(0,n.SU)(v).isStopped()?((0,a.wg)(),(0,a.j4)(c,{key:0,size:"md",outline:"",color:"dark",label:(0,n.SU)(l).screen.gt.md?(0,n.SU)(t)("Play"):"",icon:"play_arrow",onClick:F,disable:S.value||!(0,n.SU)(b).hasElements},null,8,["label","disable"])):(0,n.SU)(v).isPlaying()?((0,a.wg)(),(0,a.j4)(c,{key:1,size:"md",outline:"",color:"dark",label:(0,n.SU)(l).screen.gt.md?(0,n.SU)(t)("Pause"):"",icon:"pause",onClick:H,disable:S.value||!(x.value&&x.value.length>0)},null,8,["label","disable"])):(0,n.SU)(v).isPaused()?((0,a.wg)(),(0,a.j4)(c,{key:2,size:"md",outline:"",color:"dark",label:(0,n.SU)(l).screen.gt.md?(0,n.SU)(t)("Resume"):"",icon:"play_arrow",onClick:V,disable:S.value||!(x.value&&x.value.length>0)},null,8,["label","disable"])):(0,a.kq)("",!0),(0,a.Wm)(c,{size:"md",outline:"",color:"dark",label:(0,n.SU)(l).screen.gt.md?(0,n.SU)(t)("Stop"):"",icon:"stop",onClick:L,disable:S.value||(0,n.SU)(v).isStopped()||!(x.value&&x.value.length>0)},null,8,["label","disable"]),(0,a.Wm)(c,{size:"md",outline:"",color:"dark",label:(0,n.SU)(l).screen.gt.md?(0,n.SU)(t)("Next"):"",icon:"skip_next",onClick:R,disable:S.value||!(0,n.SU)(b).allowSkipNext},null,8,["label","disable"]),(0,a.Wm)(c,{size:"md",outline:"",color:"dark",label:(0,n.SU)(l).screen.gt.md?(0,n.SU)(t)("Download"):"",icon:"save_alt",disable:S.value||!(0,n.SU)(b).getCurrentElementURL,href:(0,n.SU)(b).getCurrentElementURL},null,8,["label","disable","href"]),(0,a.Wm)(c,{size:"md",outline:"",color:"dark",label:(0,n.SU)(l).screen.gt.md?(0,n.SU)(t)("Save as"):"",icon:"save_alt",disable:S.value||!(x.value&&x.value.length>0),onClick:D},null,8,["label","disable"])])),_:1}),(0,a.Wm)(B,{ref_key:"tableRef",ref:g,class:"my-sticky-header-table",style:{height:"46.8em"},title:"Current playlist",rows:f.value,columns:h,"row-key":"id","virtual-scroll":"","rows-per-page-options":[0],"visible-columns":w.value,"hide-bottom":!0},{body:(0,a.w5)((e=>[(0,a.Wm)(Q,{class:(0,s.C_)(["cursor-pointer",{"selected-row":C.value+1==e.row.index}]),props:e,onClick:l=>z(l,e.row,e.row.index-1)},{default:(0,a.w5)((()=>[(0,a.Wm)(k,{key:"index",props:e},{default:(0,a.w5)((()=>[C.value+1==e.row.index?((0,a.wg)(),(0,a.j4)(m,{key:0,name:y.value,color:"pink",size:"sm",class:"q-mr-sm"},null,8,["name"])):(0,a.kq)("",!0),(0,a.Uk)(" "+(0,s.zw)(e.row.index)+" / "+(0,s.zw)(f.value.length),1)])),_:2},1032,["props"]),(0,a.Wm)(k,{key:"title",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,s.zw)(e.row.title),1)])),_:2},1032,["props"]),(0,a.Wm)(k,{key:"artist",props:e},{default:(0,a.w5)((()=>[e.row.artist.name?((0,a.wg)(),(0,a.j4)(A,{key:0,class:(0,s.C_)({"text-white text-bold":!1}),to:{name:"artist",params:{name:e.row.artist.name}}},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{name:"link",class:"q-mr-sm"}),(0,a.Uk)((0,s.zw)(e.row.artist.name),1)])),_:2},1032,["to"])):(0,a.kq)("",!0)])),_:2},1032,["props"]),(0,a.Wm)(k,{key:"albumArtist",props:e},{default:(0,a.w5)((()=>[e.row.album.artist.name?((0,a.wg)(),(0,a.j4)(A,{key:0,class:(0,s.C_)({"text-white text-bold":!1}),to:{name:"artist",params:{name:e.row.album.artist.name}}},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{name:"link",class:"q-mr-sm"}),(0,a.Uk)((0,s.zw)(e.row.album.artist.name),1)])),_:2},1032,["to"])):(0,a.kq)("",!0)])),_:2},1032,["props"]),(0,a.Wm)(k,{key:"albumTitle",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,s.zw)(e.row.album.title),1)])),_:2},1032,["props"]),(0,a.Wm)(k,{key:"albumTrackIndex",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,s.zw)(e.row.trackNumber),1)])),_:2},1032,["props"]),(0,a.Wm)(k,{key:"year",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,s.zw)(e.row.album.year),1)])),_:2},1032,["props"]),(0,a.Wm)(k,{key:"actions",props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{outline:""},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{size:"sm",color:"white","text-color":"grey-5",icon:"north",title:(0,n.SU)(t)("Up"),disable:"",onClick:_},null,8,["title"]),(0,a.Wm)(c,{size:"sm",color:"white","text-color":"grey-5",icon:"south",title:(0,n.SU)(t)("Down"),disable:"",onClick:E},null,8,["title"]),(0,a.Wm)(c,{size:"sm",color:"white","text-color":e.row.favorited?"pink":"grey-5",icon:"favorite",title:(0,n.SU)(t)("Toggle favorite"),onClick:l=>q(e.row.id,e.row.favorited)},null,8,["text-color","title","onClick"]),(0,a.Wm)(c,{size:"sm",color:"white","text-color":"grey-5",icon:"delete",title:(0,n.SU)(t)("Remove"),onClick:(0,r.iM)((l=>T(e.row.index-1)),["stop","prevent"])},null,8,["title","onClick"])])),_:2},1024)])),_:2},1032,["props"])])),_:2},1032,["props","onClick","class"])])),_:1},8,["rows","visible-columns"])])),_:1}),(0,a.Wm)(J,{modelValue:U.value,"onUpdate:modelValue":i[3]||(i[3]=e=>U.value=e)},{default:(0,a.w5)((()=>[(0,a.Wm)(Y,{style:{"min-width":"350px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(M,null,{default:(0,a.w5)((()=>[p])),_:1}),(0,a.Wm)(M,{class:"q-pt-none"},{default:(0,a.w5)((()=>[(0,a.Wm)(G,{outlined:"",dense:"",modelValue:I.value,"onUpdate:modelValue":i[0]||(i[0]=e=>I.value=e),autofocus:"",onKeyup:i[1]||(i[1]=(0,r.D2)((e=>U.value=!1),["enter"])),label:"Playlist name"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(M,{class:"q-pt-none"},{default:(0,a.w5)((()=>[(0,a.Wm)(K,{label:"Public",color:"pink",modelValue:P.value,"onUpdate:modelValue":i[2]||(i[2]=e=>P.value=e)},null,8,["modelValue"])])),_:1}),(0,a.Wm)(O,{align:"right",class:""},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(c,{outline:"",label:"Cancel"},null,512),[[X]]),(0,a.Wm)(c,{outline:"",label:"Save",disable:!I.value,onClick:j},null,8,["disable"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var b=t(4458),k=t(2605),g=t(8052),f=t(7236),h=t(8879),w=t(9994),y=t(136),x=t(6384),C=t(3532),S=t(7220),U=t(2857),I=t(2074),P=t(3190),W=t(6611),_=t(3175),E=t(1821),q=t(2146),T=t(9984),z=t.n(T);const A=v,Q=A;z()(v,"components",{QCard:b.Z,QBreadcrumbs:k.Z,QBreadcrumbsEl:g.Z,QBtnGroup:f.Z,QBtn:h.Z,QTable:w.Z,QSpace:y.Z,QSelect:x.Z,QTr:C.Z,QTd:S.Z,QIcon:U.Z,QDialog:I.Z,QCardSection:P.Z,QInput:W.Z,QToggle:_.Z,QCardActions:E.Z}),z()(v,"directives",{ClosePopup:q.Z})}}]);